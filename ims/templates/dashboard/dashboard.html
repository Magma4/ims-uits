<!doctype html>
<html lang="en" >
    {% load static %}

    <head>
        <meta charset="utf-8" />
        <title>{% block title %} Dashboard {% endblock %}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- jquery.vectormap css -->
        <link href="{% static 'libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css' %}" rel="stylesheet"
            type="text/css" />

        <!-- Bootstrap Css -->
        <link href="{% static 'css/bootstrap.min.css' %}" id="bootstrap-style" rel="stylesheet" type="text/css" />
        <link href="{% static 'libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />
        <link href="{% static 'libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />

        <!-- Responsive datatable examples -->
        <link href="{% static 'libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />

        <!-- Icons Css -->
        <link href="{% static 'css/icons.min.css' %}" rel="stylesheet" type="text/css" />
        <!-- App Css-->
        <link href="{% static 'css/app.min.css' %}"  id="app-style"  rel="stylesheet" type="text/css" />


        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
        integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
        integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script> 
    <style>
        body[data-layout=detached] #layout-wrapper::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        height: 165px;
        background: -webkit-gradient(linear, left top, right top, from(#273c92), to(#293e92));
        background: linear-gradient(to right, #0a3816, #0a3816);
        }

        body[data-layout=detached] .vertical-menu .user-img img {
            padding: 6px;
            border: 2px dashed #0a3816;
        }
        body{
            color: black;
        }

        th{
            text-align: center;
        }
        
        #mcard {
        margin: 2px;
        opacity: 0.9;
        }

        #timeline-chart .apexcharts-toolbar {
        opacity: 1;
        border: 0;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-pending {
            background-color: yellow;
        }

        .status-approved {
            background-color: green;
        }

        .status-released {
            background-color: red;
        }

        .status-returned {
            background-color: gray;
        }

        #sidebar-menu ul li a {
    
            display: block;
            padding: 10px 15px;
            text-decoration: none;
        }

        #sidebar-menu ul li a:hover {
            background-color: #0a3816;
            color: white;
            text-decoration: none;
        }

        #sidebar-menu ul li a.active {
            background-color: #0a3816;
            color: white;

            
        }

        /* #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loader {
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        } */

        @keyframes rotate {
            to {
                transform: rotateZ(360deg);
            }
            }

            * {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            }

            #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Ensure it's above other content */
            }

            section.wrapper {
            padding: 40px 0;
            }

            div.spinner {
            animation: rotate 10s infinite linear;
            position: relative;
            display: block;
            margin: auto;
            width: 204px;
            height: 204px;
            }

            div.spinner i {
            animation: rotate 3s infinite cubic-bezier(.09, .6, .8, .03);
            transform-origin: 50% 100% 0;
            position: absolute;
            display: inline-block;
            top: 50%;
            left: 50%;
            border: solid 6px transparent;
            border-bottom: none;
            }

            div.spinner i:nth-child(1) {
            animation-timing-function: cubic-bezier(.09, .3, .12, .03);
            width: 42px;
            height: 21px;
            margin-top: -21px;
            margin-left: -21px;
            border-color: #2172b8;
            border-top-left-radius: 36px;
            border-top-right-radius: 36px;
            }

            div.spinner i:nth-child(2) {
            animation-timing-function: cubic-bezier(.09, .6, .24, .03);
            width: 58px;
            height: 29px;
            margin-top: -29px;
            margin-left: -29px;
            border-color: #18a39b;
            border-top-left-radius: 42px;
            border-top-right-radius: 42px;
            }

           
            

            


    </style>

</head>

<body data-layout="detached" data-topbar="colored" style="color:black" data-new-gr-c-s-check-loaded="14.1171.0" data-new-gr-ext-installed >

    {% for message in messages %}

  <div class="toast notification bg-{% if message.tags == 'error' %}danger{% else %}{{message.tags}}{% endif %}" role="alert" aria-live="assertive" aria-atomic="true" data-delay="4000" style="
    position: absolute;
    top: 10rem;
    right: 1rem;
    z-index: 1000;
    color: white;
    font-weight: normal;
">
    <div class="toast-header">
      <strong class="mr-auto">
        {% if message.tags == 'error' %}
          <i class="fas fa-times mr-2"></i>
        {% elif message.tags == 'warning' %}
          <i class="fas fa-exclamation mr-2"></i>
        {% elif message.tags == 'info' %}
          <i class="fas fa-info mr-2"></i>
        {% elif message.tags == 'success' %}
          <i class="fas fa-check mr-2"></i>
        {% endif %}
        {{message.tags|capfirst}}
      </strong>
      
    </div>
    <div class="toast-body">
      {{message|safe}}
    </div>
  </div>
{% endfor %}

<div id="preloader" style="display: none;">
    <section class="wrapper dark">
        <div class="spinner">
            
            <i></i>
            <i></i>
            
        </div>
    </section>
</div>




    <!-- <body data-layout="horizontal" data-topbar="dark"> -->

<div class="container-fluid" >
    <!-- Begin page -->
    <div id="layout-wrapper" >

        <header id="page-topbar" style="background-color: #1c4f24;">
            <div class="navbar-header" style="background-color: #1c4f24;">
                <div class="container-fluid" style="background-color: #1c4f24;">
                    <div class="float-end" >

                        <div class="dropdown d-inline-block d-lg-none ms-2">
                            
                            <!-- <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0"
                                aria-labelledby="page-header-search-dropdown">

                                <form class="p-3">
                                    <div class="m-0">
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="Search ..."
                                                aria-label="Recipient's username">
                                            <div class="input-group-append">
                                                <button class="btn btn-primary" type="submit"><i
                                                        class="mdi mdi-magnify"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div> -->
                        </div>

                        <div class="dropdown d-none d-sm-inline-block" >
                            
                            <div class="dropdown-menu dropdown-menu-end">

                                <!-- item-->
                               
                            </div>
                        </div>

                        <div class="dropdown d-none d-lg-inline-block ms-1" >
                            <button type="button" class="btn header-item noti-icon waves-effect" data-toggle="fullscreen">
                                <i class=""></i>
                            </button>
                        </div>

                        

                                  

                        <div class="dropdown d-inline-block" >
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown"
                                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="{{user.profile.image.url}}"
                                    alt="Header Avatar">
                                <span class="d-none d-xl-inline-block ms-1">{{ user.username|title }}</span>
                                <i class="mdi mdi-chevron-down d-none d-xl-inline-block"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item" href="{% url 'profile' %}"><i class="bx bx-user font-size-16 align-middle me-1"></i>
                                    Profile</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item text-danger" href="{% url 'user-logout' %}"><i
                                        class="bx bx-power-off font-size-16 align-middle me-1 text-danger"></i> Logout</a>
                            </div>
                        </div>

                       

                    </div>
                    <div >
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            

                            <a href="{% url 'dashboard' %}" class="logo logo-light">
                                
                                <span class="logo-lg">
                                    <h4 style="margin-top: 1rem;color: white;"><img src="{% static 'knustlogo.png' %}" alt="" height="30" >  UITS - IMS</h4>
                                    
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-16 header-item toggle-btn waves-effect"
                            id="vertical-menu-btn" >
                            <i class="fa fa-fw fa-bars"></i>
                        </button>

                        <!-- App Search-->
                        <form class="app-search d-none d-lg-inline-block" style="margin-top: 1rem;" >
                            <!-- <div class="position-relative">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="bx bx-search-alt"></span>
                            </div> -->
                        </form>
                    </div>
                </div>
            </div>
        </header> <!-- ========== Left Sidebar Start ========== -->
<div class="vertical-menu" style="border-color: black; background-color: ;">

<div class="h-100" >

    <div class="user-wid text-center py-4">
        <div class="user-img" style="border-color: #1c4f24;">
            <img src="{{user.profile.image.url}}" alt="" class="avatar-md mx-auto rounded-circle">
        </div>

        <div class="mt-3">

            <a href="{% url 'profile' %}" class="text-body fw-medium font-size-16">{{user.first_name|title}} {{user.last_name|title}}</a>
            <p class="text-muted mt-1 mb-0 font-size-13">{{user.profile.jobTitle|title}}</p>

        </div>
    </div>

    <!--- Sidemenu -->
    <div id="sidebar-menu">
        <!-- Left Menu Start -->
        <ul class="metismenu list-unstyled" id="side-menu">
            <li class="menu-title">Menu</li>
            {% block content %}
            <li>
                <a href="{% url 'dashboard' %}" class="waves-effect {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                    <i class="mdi mdi-airplay"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            {% if request.user.is_superuser or is_sub_admin %}
            <li>
                <a href="{% url 'view-request' %}" class="waves-effect {% if request.resolver_match.url_name == 'view-request' %}active{% endif %}">
                    <i class="mdi mdi-plus-box"></i>
                    <span>Requisitions</span>
                </a>
            </li>
            {% endif %}
    
            {% if user.is_authenticated and user.is_staff and user.is_superuser %}
            <li>
                <a href="{% url 'view-stock' %}" class="waves-effect {% if request.resolver_match.url_name == 'view-stock' %}active{% endif %}">
                    <i class="mdi mdi-warehouse"></i>
                    <span>Items</span>
                </a>
            </li>
            {% else %}
            <li>
                <a href="{% url 'view-stock' %}" class="waves-effect {% if request.resolver_match.url_name == 'view-stock' %}active{% endif %}">
                    <i class="mdi mdi-table-headers-eye"></i>
                    <span>View Items</span>
                </a>
            </li>
            {% endif %}
    
            {% if request.user.is_superuser  %}
            <li>
                <a href="{% url 'report' %}" class="waves-effect {% if request.resolver_match.url_name == 'report' %}active{% endif %}">
                    <i class="mdi mdi-chart-timeline-variant"></i>
                    <span>Report</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </div>
    
    <!-- Sidebar -->
</div>
</div>
<!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content" >

            <div class="page-content" >
                
                <!-- start page title -->
                <div class="row" style="background-color: #1c4f24;" >
                    <div class="col-12" style="background-color: #1c4f24;">
                        <div class="page-title-box d-flex align-items-center justify-content-between" >
                            <h4 class="page-title mb-0 font-size-18">Dashboard</h4>

                            <div class="page-title-right" style="background-color: #1c4f24;">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item active">Welcome {{user.first_name|title}} {{user.last_name|title}}</li>
                                </ol>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- end page title -->
                {% if user.is_authenticated and user.is_staff and user.is_superuser %}
                <div class="row">
                    <div class="col-xl-3">
                        <div class="card shadow-lg">
                            <div class="card-body">
                                <div class="d-flex align-items-start">
                                    <div class="avatar-sm font-size-20 me-3">
                                        <span class="avatar-title bg-soft-primary text-primary rounded">
                                            <i class="mdi mdi-tag-plus-outline" style="color: #359e45;"></i>
                                        </span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-size-16 mt-2">All Requisitions</div>
                                    </div>
                                </div>
                                <h4 class="mt-4">
                                    {% with all_orders.count as total_orders %}
                                    {{ total_orders }}
                                    {% endwith %}</h4>
                                <div class="row">
                                    <div class="col-6">
                                        <p class="mb-0" style="margin-top: 1rem;"><span class="text-success me-2"> <a href="{% url 'view-request' %}" style="color: #359e45;">See All Requisitions</a> </span></p>
                                    </div>
                                    
                                      
                                      <div class="col-6 align-self-center">
                                        <div>
                                            <button id="add-request" class="btn btn-primary btn mdi mdi-plus" type="button" name="button" style="background-color: #359e45; border: none;" data-bs-toggle="modal" data-bs-target="#request-modal">
                                                Request Item
                                            </button>
                                        </div>
                                        <div class="modal fade" id="request-modal" tabindex="-1" role="dialog" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                          <div class="modal-content">
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        <div class="card shadow-lg">
                            <div class="card-body">
                                <div class="d-flex align-items-start">
                                    <div class="avatar-sm font-size-20 me-3">
                                        <span class="avatar-title bg-soft-primary text-primary rounded">
                                            <i class="mdi mdi-store" style="color: #359e45;"></i>
                                        </span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-size-16 mt-2">Items</div>

                                    </div>
                                </div>
                                <h4 class="mt-4">
                                    {% with items.count as total_items %}
                                        {{ total_items }}
                                    {% endwith %}
                                </h4>
                                <div class="row">
                                    <div class="col-6">
                                        <p class="mb-0" style="margin-top: 1rem;"><span class="text-success me-2"> <a href="{% url 'view-stock' %}" style="color: #359e45;">See All Items</a> </span></p>
                                    </div>
                                    <div class="col-6 align-self-center">
                                        <div>
                                            <button id="add-stock" class="btn btn-primary btn mdi mdi-plus" type="button" name="button" style="background-color: #359e45; border: none;" data-bs-toggle="modal" data-bs-target="#stock-modal">
                                                Add Item
                                            </button>
                                        </div>
                                        <div class="modal fade" id="stock-modal" tabindex="-1" role="dialog" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                          <div class="modal-content">
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="col-xl-9">
                        <div class="card shadow-lg">
                            <div class="card-body" id="">
                                <h4 class="card-title mb-4">Monthly Requisitions Report</h4>
                                <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
                                <div id="timeline-chart"></div>
                                <script>
                                    var months = {{ months | safe }};
                                    var orderCounts = {{ order_counts | safe }};

                                    var options = {
                                        chart: {
                                            type: 'line',  // Use 'area' if you want a standard area chart look
                                            height: 280,
                                            foreColor: "#999",
                                            dropShadow: {
                                                enabled: true,
                                                top: -2,
                                                left: 2,
                                                blur: 5,
                                                opacity: 0.06
                                            }
                                        },
                                        colors: ['#00E396'], // Single color for the current year
                                        stroke: {
                                            curve: 'smooth',
                                            width: 3
                                        },
                                        series: [{
                                            name: 'Total Request',
                                            data: orderCounts
                                        }],
                                        markers: {
                                            size: 5,
                                            hover: {
                                                size: 8
                                            }
                                        },
                                        xaxis: {
                                            categories: months,
                                            tickPlacement: 'on'
                                        },
                                        tooltip: {
                                            x: {
                                                format: 'MMM'
                                            },
                                            y: {
                                                formatter: function(value) {
                                                    return value + " request(s)";
                                                }
                                            }
                                        },
                                        legend: {
                                            position: 'top',
                                            horizontalAlign: 'right'
                                        },
                                        grid: {
                                            row: {
                                                colors: ['#f3f3f3', 'transparent'],
                                                opacity: 0.5
                                            },
                                        },
                                        fill: {
                                            type: 'gradient',
                                            gradient: {
                                                shadeIntensity: 1,
                                                opacityFrom: 0.7,
                                                opacityTo: 0.3,
                                                stops: [0, 100],
                                                type: 'vertical'  // Ensure vertical filling if needed
                                            }
                                        }
                                    };

                                    var chart = new ApexCharts(document.querySelector("#timeline-chart"), options);
                                    chart.render();
                                </script>

                                </div>
                            </div>
                        </div>
                    
                    
                            
                        
                        

                    

                    
                </div>
                <!-- end row -->

                <div class="row">
                    <div class="col-xl-6">
                        <div class="card shadow-lg">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Requisition Analytics</h4>
                                Total Items In Use: <strong>{{ total_released_quantity }}</strong>

                                <div class="row align-items-center">
                                    <div class="col-sm-12">
                                        <div id="chart" >
                                            <script>
                                                var ordersData = [
                                                {% for item in released_items_quantity %}
                        {
                            name: "{{ item.item_name__name|title }}",
                            quantity: {{ item.total_quantity }},
                        },
                    {% endfor %}
                                                ];
                                            
                                                var options = {
                                                    chart: {
                                                        type: "donut",
                                                        height: 295,
                                                    },
                                                    series: ordersData.map(item => item.quantity),
                                                    labels: ordersData.map(item => item.name),
                                                    // Add other chart options here
                                                };
                                            
                                                var chart = new ApexCharts(document.querySelector("#chart"), options);
                                                chart.render();
                                            </script>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-6">
                        <div class="card shadow-lg">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Items In Stock</h4>
                                <div id="bar_chart" class="apex-charts">
                                    <script>
                                        var options = {
                                            chart: {
                                                height: 320,
                                                type: 'bar',
                                            },
                                            plotOptions: {
                                                bar: {
                                                    horizontal: false, // Change to true for horizontal bars
                                                }
                                            },
                                            dataLabels: {
                                                enabled: false,
                                            },
                                            xaxis: {
                                                categories: [{% for items in items %} "{{items|title}}", {% endfor %}],
                                                title: {
                                                    text: 'Items',
                                                },
                                            },
                                            yaxis: {
                                                title: {
                                                    text: 'Quantity',
                                                },
                                            },
                                            series: [{
                                                name: 'Number Of Products',
                                                data: [{% for items in items %} {{ items.get_total_quantity }}, {% endfor %}],
                                            }],
                                            colors: ['#359e45'], // Set the color of the bars to green
                                        };
                                    
                                        // Initialize the chart with the options
                                        var chart = new ApexCharts(document.querySelector("#bar_chart"), options);
                                    
                                        // Render the chart
                                        chart.render();
                                    </script>
                                    
                                </div>
                                
                            </div>
                        </div>
                    </div>

                    
                <!-- end row -->

                

                <div class="row">
                    
                    <div class="col-12">
                        <div class="card shadow-lg">
                            <div class="card-body">
                                <h4 class="card-title" style="text-align: center;">Overdue Requests({{overdue_orders_total}})</h4>

                                <div class="table-responsive">
                                    <table id="datatable" class="table table-bordered dt-responsive nowrap"
                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead >
                                            <tr style="background-color: #1c4f24;">
                                                <th scope="col" style="text-align: center;">Request ID</th>
                                                <th scope="col" style="text-align: center;"> Name</th>
                                                <th scope="col" style="text-align: center;">Issued To</th>
                                                <th scope="col" style="text-align: center;">Item Name</th>
                                                <th scope="col" style="text-align: center;">Quantity</th>
                                                <th scope="col" style="text-align: center;">Mobile No</th>
                                                <th scope="col" style="text-align: center;">Released By</th>
                                                <th scope="col" style="text-align: center;">Date</th>
                                                <th scope="col" style="text-align: center;">Due Date</th>
                                                <th scope="col" style="text-align: center;">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-group-divider">
                                            {% for overdue in overdue_orders %}
                                            <tr>
                                                <td style="text-align: center;">{{overdue.id}}</td>
                                                <td ><a href="{% url 'employees-detail' pk=overdue.users.id %}" title="View Profile"><img src="{{overdue.users.profile.image.url}}" alt=" "
                                                    class="rounded-circle img-fluid" style="width: 35px;"></a> {{ overdue.users.first_name|title }} {{ overdue.users.last_name|title }}</td>
                                                <td>
                                                    {% if overdue.issued_to == None %}
                                                        Self
                                                    {% else %}
                                                        {{ overdue.issued_to|title }}
                                                    {% endif %}
                                                </td>
                                                <td>{{ overdue.item_name|title }}</td>
                                                <td style="text-align: center;">{{ overdue.request_quantity }}</td>
                                                <td>{{ overdue.users.profile.contact|title }}</td>
                                                <td>{{ overdue.released_by|title }}</td>
                                                <td style="text-align: center;">{{ overdue.date}}</td>
                                                <td>{{ overdue.intended_date_of_return}}</td>
                                                <td style="text-align: center;"><form id="send_email" method="POST" action="{% url 'dashboard' %}">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="order_id" value="{{ overdue.id }}">
                                                    <button type="submit" class="btn btn-warning btn-sm" name="send_email" data-bs-toggle="tooltip2" data-bs-placement="top" title="Send Email Reminder">
                                                        <i class="mdi mdi-gmail"></i>
                                                    </button>
                                                </form>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                
                                
                                
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end row -->
            </div>
            <!-- End Page-content -->

            {% else %}
            <div class="row">
                <div class="col-md-8 col-xl-3">
                    <div class="card shadow-lg">
                        <div class="card-body" style="padding: 0%;margin-top: 1rem;margin-bottom: -0.9rem;">
                            <div class="profile-widgets py-3">
                                <div class="card-body" >
                                    <div class="d-flex align-items-start" style="margin-top: -2rem;">
                                        <div class="avatar-sm font-size-20 me-3">
                                            <span class="avatar-title bg-soft-primary text-primary rounded">
                                                <i class="mdi mdi-tag-plus-outline" style="color: #359e45;"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-size-16 mt-2">All Requests</div>
                                        </div>
                                    </div>
                                    <h4 class="mt-4">{{ order_count }}</h4>
                                    <div class="row">
                                        
                                        <div class="col-6 align-self-center">
                                            <div>
                                                <button id="add-request" class="btn btn-primary btn mdi mdi-plus" type="button" name="button" style="background-color: #359e45; border: none;" data-bs-toggle="modal" data-bs-target="#request-modal">
                                                    Request Item
                                                </button>
                                            </div>
                                            <div class="modal fade" id="request-modal" tabindex="-1" role="dialog" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                              <div class="modal-content">
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-xl-9" >
                    <div class="row">
                        <div class="col-md-12 col-xl-4">
                            <div class="card shadow-lg">
                                <div class="card-body">
                                    <div class="d-flex align-items-start">
                                        <div class="avatar-sm font-size-20 me-3">
                                            <span class="avatar-title bg-soft-primary text-primary rounded">
                                                <i class="mdi mdi-cart-outline" style="color: #359e45;"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-size-16 mt-2">Items in use</div>
                                        </div>
                                    </div>
                                    <h4 class="mt-4">{{ released_orders }}</h4>
                                    <div class="row">
                                        <div class="col-8">
                                            <p class="mb-0" style="margin-top: 1rem;">
                                                <span class="text-success me-2">
                                                    
                                                </span>
                                            </p>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12 col-xl-4">
                            <div class="card shadow-lg">
                                <div class="card-body">
                                    <div class="d-flex align-items-start">
                                        <div class="avatar-sm font-size-20 me-3">
                                            <span class="avatar-title bg-soft-primary text-primary rounded">
                                                <i class="mdi mdi-timer-sand" style="color: #359e45;"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-size-16 mt-2">Pending Requests</div>
                                        </div>
                                    </div>
                                    <h4 class="mt-4">{{ pending_user_orders }}</h4>
                                    <div class="row">
                                        <div class="col-8">
                                            <p class="mb-0" style="margin-top: 1rem;">
                                                <span class="text-success me-2">
                                                   
                                                </span>
                                            </p>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="col-md-12 col-xl-4" style="margin-top: 2rem;">
                            <div class="card shadow-lg">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-8">
                                            <p class="mb-2">Pending Requests</p>
                                            <h4 class="mb-0">{{ pending_user_orders }}</h4>
                                        </div>
                                        <div class="col-4">
                                            <div class="text-end">
                                                <div>
                                                     <i class="mdi  text-success ms-1"></i>
                                                </div>
                                                <div class="progress progress-sm mt-3">
                                                    <div class="progress-bar bg-warning" role="progressbar" style="width: {{pending_percentage}}%" aria-valuenow="{{pending_percentage}}" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                        
                        <!-- Replicated card -->
                        <div class="col-md-12 col-xl-4">
                            <div class="card shadow-lg">
                                <div class="card-body">
                                    <div class="d-flex align-items-start">
                                        <div class="avatar-sm font-size-20 me-3">
                                            <span class="avatar-title bg-soft-primary text-primary rounded">
                                                <i class="mdi mdi-store" style="color: #359e45;"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-size-16 mt-2">Items</div>
                                        </div>
                                    </div>
                                    <h4 class="mt-4">{% with items.count as total_items %}
                                        {{ total_items }}
                                    {% endwith %}</h4>
                                    <div class="row">
                                        <div class="col-8">
                                            <p class="mb-0" style="margin-top: 1rem;">
                                                <span class="text-success me-2">
                                                    <a href="{% url 'view-stock' %}" style="color: #359e45;">See Items in Stock</a>
                                                </span>
                                            </p>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End of replicated card -->
                    </div>
                </div>
            </div>

            <div class="row">
                    
                <div class="col-md-12">
                    <div class="card shadow-lg">
                        <div class="card-body">
                            <h4 class="card-title" style="text-align: center;">Your Requests({{ order_count }})</h4>

                            <div class="table-responsive">
                                <table id="datatable" class="table table-bordered dt-responsive nowrap"
                                style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                    <thead >
                                        <tr>
                                            <th scope="col" style="text-align: center;">Request ID</th>
                                            <th scope="col" style="text-align: center;">Item Name</th>
                                            <th scope="col" style="text-align: center;">Issued To</th>
                                            <th scope="col" style="text-align: center;">Description</th>
                                            <th scope="col" style="text-align: center;">Quantity</th>
                                            <th scope="col" style="text-align: center;">Request Date</th>
                                            <th scope="col" style="text-align: center;">Date Returned</th>
                                            <th scope="col" style="text-align: center;">Status</th>
                                            <th scope="col" style="text-align: center;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for order in all_orders %}
                                        {% if order.users == user %}
                                        <tr>
                                            <td style="text-align: center;">{{ order.id}}</td>
                                            <td>{{ order.item_name.name|title }}</td>
                                            <td>
                                                {% if order.issued_to == None %}
                                                    Self
                                                {% else %}
                                                    {{ order.issued_to|title }}
                                                {% endif %}
                                            </td>
                                            <td>{{ order.request_description|title }}</td>
                                            <td style="text-align: center;">{{ order.request_quantity }}</td>
                                            <td style="text-align: center;">{{ order.date }}</td>
                                            <td>{{ order.returned_date }}</td>
                                            <td>
                                                <span class="badge 
                                                    {% if order.status == 'pending' %}
                                                        text-bg-warning
                                                    {% elif order.status == 'approved' %}
                                                        text-bg-success
                                                    {% elif order.status == 'released' %}
                                                        text-bg-danger
                                                    {% elif order.status == 'returned' %}
                                                        text-bg-secondary
                                                    {% endif %}
                                                    font-size-12">
                                                    {{ order.status|title }}
                                                </span>
                                            </td>
                                            {% if order.status == 'pending' %}
                                                <td style="text-align: center;">
                                                    <button type="button" class="order-update bs-modal btn btn-sm btn-primary" data-form-url="{% url 'order-update' order.id %}">
                                                        Edit
                                                      </button>
                                                      <div class="modal fade" tabindex="-1" role="dialog" id="modal" role="dialog" aria-hidden="true">
                                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                                          <div class="modal-content"></div>
                                                        </div>
                                                      </div>
                                                      <button type="button" class="order-delete bs-modal btn btn-sm btn-danger" data-form-url="{% url 'order-delete' order.id %}">
                                                        Delete
                                                      </button>
                                                      <div class="modal fade" tabindex="-1" role="dialog" id="modal" role="dialog" aria-hidden="true">
                                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                                          <div class="modal-content"></div>
                                                        </div>
                                                </td>

                                                <div class="modal fade" id="deleteModal{{ order.id }}" tabindex="-1" aria-labelledby="deleteModal{{ order.id }}Label" aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="deleteModal{{ order.id }}Label">Delete</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <h4 class="alert alert-warning" style="text-align: center;">
                                                                    <i class="mdi mdi-alert-outline me-2"></i>
                                                                    <div role="alert" style="text-align: center;">
                                                                        Are you sure you want to delete this request?
                                                                    </div>
                                                                </h4>
                                                            </div>
                                                            <div class="row justify-content-center mt-3">
                                                                <div class="col-md-6">
                                                                    <form id="deleteForm{{ order.id }}" action="{% url 'order-delete' pk=order.id %}" method="POST">
                                                                        {% csrf_token %}
                                                                        <div style="text-align: center;margin-bottom: 1rem;">
                                                                            <!-- Cancel button with data-bs-dismiss attribute to close the modal -->
                                                                            <a class="btn btn-secondary" href="{% url 'dashboard' %}" data-bs-dismiss="modal">Cancel</a>
                                                                            <!-- Confirm button with an ID for event handling -->
                                                                            <button class="btn btn-danger delete-confirm-btn" type="submit">Confirm</button>
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% else %}
                                                <td>
                                                    <p>Request cannot be altered</p>
                                                </td>
                                                {% endif %}
                                        </tr>
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            
                            
                        </div>
                    </div>
                </div>
            </div>
            
            

            
            {% endif %}
            <script>
                $(document).ready(function() {
                    $('#datatable').DataTable({
                        "order": [[0, "desc"]] 
                    });
                });

                $(document).ready(function() {
                    $('[data-bs-toggle="tooltip2"]').tooltip();
                });
            </script>
            {% endblock %}
            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>document.write(new Date().getFullYear())</script>  UITS.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Designed & Developed by USSD
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

</div>
<!-- end container-fluid -->

<!-- Right Sidebar -->



</div>


<!-- /Right-bar -->

<!-- Right bar overlay-->
<div class="rightbar-overlay"></div>

<!-- JAVASCRIPT -->
<!-- JAVASCRIPT -->
<!-- <script src="{% static 'libs/jquery/jquery.min.js' %}"></script> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- <script src="{% static 'libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script> -->
<script src="{% static 'libs/metismenu/metisMenu.min.js' %}"></script>
<script src="{% static 'libs/simplebar/simplebar.min.js' %}"></script>
<script src="{% static 'libs/node-waves/waves.min.js' %}"></script>
<script src="{% static 'libs/jquery-sparkline/jquery.sparkline.min.js' %}"></script>
<script src="{% static 'libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<!-- Buttons examples -->
<script src="{% static 'libs/datatables.net-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js' %}"></script>
<script src="{% static 'libs/jszip/jszip.min.js' %}"></script>
<script src="{% static 'libs/pdfmake/build/pdfmake.min.js' %}"></script>
<script src="{% static 'libs/pdfmake/build/vfs_fonts.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.print.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.colVis.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js' %}"></script>
<script src="{% static 'js/jquery.bootstrap.modal.forms.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>





<!-- apexcharts -->
<script src="{% static 'libs/apexcharts/apexcharts.min.js' %}"></script>

<!-- jquery.vectormap map -->
<script src="{% static 'libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
<script src="{% static 'libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-us-merc-en.js' %}"></script>

<script src="{% static 'js/pages/dashboard.init.js' %}"></script>

<script src="{% static 'js/app.js' %}"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var toggles = document.querySelectorAll('.has-arrow');

    toggles.forEach(function(toggle) {
        toggle.addEventListener('click', function(e) {
            e.preventDefault();
            var submenu = this.nextElementSibling;
            var isExpanded = submenu.getAttribute('aria-expanded') === 'true';
            submenu.style.display = isExpanded ? 'none' : 'block';
            submenu.setAttribute('aria-expanded', !isExpanded);
        });
    });
});
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    var menuButton = document.querySelector('#vertical-menu-btn');
    var body = document.body;

    menuButton.addEventListener('click', function() {
        body.classList.toggle('sidebar-enable');
    });
});
</script>
<script src="{% static 'js/jquery-3.4.1.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="{% static 'libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'js/pages/datatables.init.js' %}"></script>
<script type="text/javascript">
    $(function () {
        $(".order-update").each(function () {
            $(this).modalForm({
                formURL: $(this).data("form-url"),
                modalID: "#modal"  // Assuming you have a modal with ID "update-modal"
            });
        }); 

        $(".stock-update").each(function () {
            $(this).modalForm({
                formURL: $(this).data("form-url"),
                modalID: "#modal"  // Assuming you have a modal with ID "update-modal"
            });
        }); 
  
        // Delete request buttons - formURL is retrieved from the data of the element
        $(".order-delete").each(function () {
            $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: true});
        });

        $(".stock-delete").each(function () {
            $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: true});
        });
  
        // Create request button opens form in modal with id="create-modal"
        $("#add-request").modalForm({
            formURL: "{% url 'add-request' %}",
            modalID: "#request-modal"
        });

        $("#add-stock").modalForm({
            formURL: "{% url 'add-stock' %}",
            modalID: "#stock-modal"
        });
  
    });
  </script>
  


{% if messages %}
  <script>
      {% for message in messages %}
          $(document).ready(function () {
              $('.toast').toast('show');
          });
      {% endfor %}
  </script>
{% endif %}
</body>

</html>
